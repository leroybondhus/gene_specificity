---
title: "knitr_testing"
author: "Leroy Bondhus"
date: "12/15/2021"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r}
library(ggplot2)
library(ggpubr)
library(biomaRt)
library(stringr)
library(dendextend)
library(dplyr)
library(Hmisc)
library(doParallel)
library(foreach)

library(ComplexHeatmap)
library(circlize)
library(scales)
library(reldist)
library(gridExtra)

library(DOSE)
library(pathview)
library(clusterProfiler)
library(org.Hs.eg.db)

library(tidyverse)
library(topGO) 
library(enrichplot)

library(data.table)

figures_dir <- paste(getwd(),"figures", sep = "/")
date <- format(Sys.time(), format="%Y%m%d") 

registerDoParallel(detectCores()-1)
```


```{r cluster and get weights, fig.show="hold", out.width="50%", fig.height= 8}

load(".Rdata")

sim_tree <- cluster_func(dot_sim)
par(mar=c(2,2,2,15))
sim_tree %>%
  dendextend::set("nodes_pch",19) %>% 
  dendextend::set("nodes_cex",2* sqrt(get_nodes_attr(sim_tree,"weight"))) %>%
  plot(horiz=T)

## take a look at the weights
temp <- get_weights(sim_tree, get_leaves_attr(sim_tree, "label"))
temp <- data.frame(weights=temp, names=factor(names(temp), levels=rev(names(temp)) ) )
g <- ggplot( temp ,aes(y=fct_rev(as.factor(names)), x=weights))+
  geom_col() #+
  #theme(axis.text.y = element_text(angle = 90, vjust = 0.5, hjust=1))
g


```


```{r look at flat and weighted distributions, fig.show="hold", out.width="50%",  fig.height=4}
weights <- get_weights(sim_tree, colnames(exp_mat))
spec_mat_weighted <- calc_weighted_zscore_matrix(exp_mat, weights = weights)
flat <- weights; flat[1:length(flat)] <- 1
spec_mat_flat  <- calc_weighted_zscore_matrix(exp_mat, flat)
## plot to look at global dif between flat and weighted
tau_flat <- calc_weighted_tau(exp_mat, flat)
tau_weighted <- calc_weighted_tau(exp_mat, weights)
tsi_flat <- calc_weighted_tsi(exp_mat,flat)
tsi_weighted <- calc_weighted_tsi(exp_mat,weights)
gini_flat <- calc_weighted_gini(exp_mat, flat)
gini_weighted <- calc_weighted_gini(exp_mat, weights)

hist(spec_mat_flat ,breaks=100)
hist(spec_mat_weighted ,breaks=100)
hist(tau_flat ,breaks=100)
hist(tau_weighted  ,breaks=100)
hist(tsi_flat ,breaks=100)
hist(tsi_weighted ,breaks=100)
hist(gini_flat ,breaks=100)
hist(gini_weighted ,breaks=100)
hist(spec_mat_weighted - spec_mat_flat ,breaks=100)
hist(tau_weighted - tau_flat ,breaks=100)
hist(tsi_weighted - tsi_flat ,breaks=100)
hist(gini_weighted - gini_flat ,breaks=100)

```

